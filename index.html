<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuiz Futsal Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct {
            border-color: #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .rationale-correct {
            color: #166534; /* green-800 */
        }
        .rationale-incorrect {
            color: #991b1b; /* red-800 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-2xl mx-auto">
        
        <!-- Skrin Login -->
        <div id="login-screen" class="bg-white p-8 rounded-xl shadow-lg text-center">
            <!-- Logo Futsal -->
            <div class="flex justify-center mb-6">
                <img id="logo" src="https://scontent.fkul16-1.fna.fbcdn.net/v/t39.30808-1/436302132_122099320082329089_2215456546373894648_n.jpg?_nc_cat=104&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=am1RbZ9CdpoQ7kNvwHC0C6S&_nc_oc=AdnxKqHkkKlFgSH4HRsut1LlMwOXjldICP1kZw-AnSTmgpUyGne_1OolC_yun1c-k5o&_nc_zt=24&_nc_ht=scontent.fkul16-1.fna&_nc_gid=AwcQFicHjhUjvq8SozNJCA&oh=00_AfX3-f1nIm7w2X5ZrirxPQr8CkDtsadq1IKNpY2ryoW0Yw&oe=689D1450" onerror="this.onerror=null;this.src='https://placehold.co/100x100/1e40af/ffffff?text=FUTSAL+LOGO';" alt="Logo Futsal" class="rounded-full w-24 h-24">
            </div>
            <h1 class="text-3xl font-bold text-blue-600 mb-2">MPU 3421-Futsal</h1>
            <p class="text-gray-600 mb-6">Uji pengetahuan anda tentang Undang-Undang Permainan Futsal.</p>
            <div class="mb-4">
                <label for="roll-number" class="block text-sm font-medium text-gray-700 mb-2">Sila masukkan nombor angka giliran anda:</label>
                <input type="text" id="roll-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Contoh: P12345">
            </div>
            <div id="loading-spinner" class="hidden my-4">
                <div class="h-6 w-6 rounded-full border-2 border-t-2 border-blue-200 border-t-blue-600 animate-spin mx-auto"></div>
            </div>
            <div id="student-info-display" class="hidden text-left mb-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                <p class="text-sm font-medium text-blue-700">Butiran pelajar:</p>
                <p id="student-name" class="text-lg font-bold text-blue-800"></p>
                <p id="student-class" class="text-md text-blue-600"></p>
            </div>
            <button id="start-quiz-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300 disabled:bg-blue-300">
                Mula Kuiz
            </button>
        </div>

        <!-- Skrin Kuiz -->
        <div id="quiz-screen" class="hidden">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <div id="question-counter" class="text-sm font-semibold text-gray-500"></div>
                    <div id="score-counter" class="text-sm font-semibold text-blue-600"></div>
                </div>
                <div id="timer-display" class="text-center text-sm font-bold text-red-600 mb-4">Masa: 10:00</div>
                <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <h2 id="question-text" class="text-xl sm:text-2xl font-bold mb-6 min-h-[6rem]"></h2>
                <div id="answer-options" class="grid grid-cols-1 gap-4">
                    <!-- Pilihan Jawapan akan dimasukkan di sini oleh JS -->
                </div>
                <div id="feedback-section" class="mt-6 hidden">
                     <p id="feedback-text" class="text-lg font-bold mb-2"></p>
                     <p id="rationale-text" class="text-sm text-gray-700 p-3 rounded-lg"></p>
                </div>
                <button id="next-question-btn" class="w-full mt-6 bg-gray-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-black transition-colors duration-300 hidden">
                    Soalan Seterusnya
                </button>
            </div>
        </div>

        <!-- Skrin Keputusan -->
        <div id="result-screen" class="hidden text-center bg-white p-8 rounded-xl shadow-lg">
             <!-- Logo Futsal -->
            <div class="flex justify-center mb-6">
                <img id="logo-result" src="https://scontent.fkul16-1.fna.fbcdn.net/v/t39.30808-1/436302132_122099320082329089_2215456546373894648_n.jpg?_nc_cat=104&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=am1RbZ9CdpoQ7kNvwHC0C6S&_nc_oc=AdnxKqHkkKlFgSH4HRsut1LlMwOXjldICP1kZw-AnSTmgpUyGne_1OolC_yun1c-k5o&_nc_zt=24&_nc_ht=scontent.fkul16-1.fna&_nc_gid=AwcQFicHjhUjvq8SozNJCA&oh=00_AfX3-f1nIm7w2X5ZrirxPQr8CkDtsadq1IKNpY2ryoW0Yw&oe=689D1450" onerror="this.onerror=null;this.src='https://placehold.co/100x100/1e40af/ffffff?text=FUTSAL+LOGO';" alt="Logo Futsal" class="rounded-full w-24 h-24">
            </div>
            <h2 class="text-3xl font-bold text-blue-600 mb-2">Kuiz Selesai!</h2>
            <div class="text-left mb-6 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                <p class="text-sm font-medium text-blue-700">Keputusan untuk:</p>
                <p id="result-user-name" class="text-lg font-bold text-blue-800"></p>
                <p id="result-user-class" class="text-md text-blue-600 mb-2"></p>
                <div class="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm">
                    <p class="text-lg font-semibold text-gray-700">Skor Akhir:</p>
                    <div>
                        <p id="final-score" class="text-3xl sm:text-4xl font-bold text-gray-800"></p>
                        <p id="score-percentage" class="text-sm font-semibold text-blue-600"></p>
                    </div>
                </div>
            </div>
            <p id="result-message" class="text-gray-700 mb-8"></p>
            <button id="restart-quiz-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                Cuba Lagi
            </button>
        </div>

    </div>

    <script>
        // URL Google Apps Script anda yang telah di-deploy
        const googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbyEMxwJIfeJb5bXySA7YXJPe3W2zp3m9GvjGpY0dMBDrG0r9RJghsrczTzGgxPXfpGe/exec';
        
        // Tetapan kuiz
        const quizDuration = 600; // Masa kuiz dalam saat (10 minit)
        const quizData = [
            {
                question: "Berapakah lebar semua garisan di atas padang futsal mengikut piawaian?",
                options: ["5cm", "8cm", "10cm", "12cm"],
                answer: "8cm",
                rationale: "Undang-Undang 1 menyatakan semua garisan mestilah selebar 8cm untuk memastikan kejelasan dan keseragaman."
            },
            {
                question: "Berapakah jarak tanda penalti pertama dari titik tengah garisan gol?",
                options: ["5m", "6m", "7m", "10m"],
                answer: "6m",
                rationale: "Tanda penalti utama terletak 6m dari titik tengah garisan gol, digunakan untuk sepakan penalti standard."
            },
            {
                question: "Apakah julat berat yang dibenarkan untuk bola futsal pada permulaan perlawanan?",
                options: ["300g - 340g", "350g - 390g", "400g - 440g", "450g - 490g"],
                answer: "400g - 440g",
                rationale: "Berat bola yang ditetapkan antara 400g hingga 440g (Undang-Undang 2) membantu dalam kawalan bola yang lebih baik di permukaan yang lebih kecil."
            },
            {
                question: "Berapakah bilangan maksimum pemain gantian yang dibenarkan dalam satu perlawanan futsal?",
                options: ["5", "7", "9", "12"],
                answer: "9",
                rationale: "Setiap pasukan dibenarkan mendaftarkan sehingga 9 pemain gantian, membolehkan pertukaran yang kerap."
            },
            {
                question: "Adakah bilangan pertukaran pemain (substitusi) dalam futsal terhad?",
                options: ["Ya, terhad kepada 5 pertukaran", "Ya, terhad kepada 7 pertukaran", "Tidak, tidak terhad", "Hanya boleh dibuat semasa bola mati"],
                answer: "Tidak, tidak terhad",
                rationale: "Undang-Undang 3 membenarkan bilangan pertukaran yang tidak terhad untuk mengekalkan tempo permainan yang tinggi."
            },
            {
                question: "Peralatan manakah yang TIDAK wajib dipakai oleh seorang pemain futsal?",
                options: ["Jersi bernombor", "Pelindung kaki (Shinguards)", "Sarung tangan (selain penjaga gol)", "Kasut bertapak getah"],
                answer: "Sarung tangan (selain penjaga gol)",
                rationale: "Sarung tangan hanya wajib untuk penjaga gol. Pemain lain tidak diwajibkan memakainya."
            },
            {
                question: "Berapa lamakah tempoh masa rehat antara separuh masa pertama dan kedua?",
                options: ["Tidak melebihi 5 minit", "Tidak melebihi 10 minit", "Tidak melebihi 15 minit", "Tidak melebihi 20 minit"],
                answer: "Tidak melebihi 15 minit",
                rationale: "Undang-Undang 7 menetapkan rehat separuh masa tidak boleh melebihi 15 minit."
            },
            {
                question: "Bolehkah gol dijaringkan terus dari satu sepak mula (kick-off)?",
                options: ["Ya, jika bola menyentuh pemain lain dahulu", "Ya, boleh dijaringkan terus", "Tidak, sama sekali tidak boleh", "Hanya jika penjaga gol lawan tersentuh bola"],
                answer: "Tidak, sama sekali tidak boleh",
                rationale: "Undang-Undang 8 menyatakan gol tidak boleh dijaringkan terus dari sepak mula. Permainan dimulakan semula dengan sepakan gol."
            },
            {
                question: "Apakah yang berlaku jika bola terkena siling semasa dalam permainan?",
                options: ["Permainan diteruskan", "Dropped ball diberikan", "Sepakan percuma tidak langsung diberikan", "Sepakan masuk (kick-in) diberikan kepada pasukan lawan"],
                answer: "Sepakan masuk (kick-in) diberikan kepada pasukan lawan",
                rationale: "Menurut Undang-Undang 9, jika bola terkena siling, permainan dimulakan semula dengan 'kick-in' untuk pasukan lawan."
            },
            {
                question: "Adakah peraturan ofsaid digunakan dalam permainan futsal?",
                options: ["Ya", "Tidak", "Hanya di kawasan penalti", "Hanya dalam perlawanan antarabangsa"],
                answer: "Tidak",
                rationale: "Undang-Undang 11 dengan jelas menyatakan bahawa tiada peraturan ofsaid dalam futsal."
            },
            {
                question: "Kesalahan manakah yang akan dihukum dengan sepakan percuma LANGSUNG?",
                options: ["Menghalang kemaraan lawan", "Bermain secara berbahaya", "Menendang atau cuba menendang lawan", "Melengahkan permulaan semula permainan"],
                answer: "Menendang atau cuba menendang lawan",
                rationale: "Menendang lawan adalah salah satu daripada tujuh kesalahan utama yang dihukum dengan sepakan percuma langsung (Undang-Undang 12)."
            },
            {
                question: "Berapa lamakah seorang penjaga gol boleh mengawal bola (dengan tangan atau kaki) di kawasannya sendiri?",
                options: ["2 saat", "4 saat", "6 saat", "Tidak terhad"],
                answer: "4 saat",
                rationale: "Penjaga gol hanya mempunyai 4 saat untuk mengawal bola di separuh padangnya sendiri untuk mengelakkan kelengahan permainan (Undang-Undang 12)."
            },
            {
                question: "Apakah tindakan pengadil jika seorang pemain menerima kad kuning kedua dalam perlawanan yang sama?",
                options: ["Memberi amaran terakhir", "Menunjukkan kad kuning dan kad merah serentak", "Mengabaikannya", "Menunjukkan kad merah dan membuang pemain dari padang"],
                answer: "Menunjukkan kad merah dan membuang pemain dari padang",
                rationale: "Menerima kad kuning kedua secara automatik mengakibatkan kad merah dan pemain tersebut dibuang padang."
            },
            {
                question: "Berapakah jarak minimum pemain pertahanan mesti berada dari bola semasa sepakan percuma?",
                options: ["3m", "5m", "7m", "9.15m"],
                answer: "5m",
                rationale: "Undang-Undang 13 memerlukan semua pemain lawan berada sekurang-kurangnya 5m dari bola sehingga ia dimainkan."
            },
            {
                question: "Bermula dari kesalahan terkumpul keberapa satu pasukan akan dihukum dengan sepakan dari tanda penalti kedua (10m)?",
                options: ["Ke-4", "Ke-5", "Ke-6", "Ke-7"],
                answer: "Ke-6",
                rationale: "Apabila satu pasukan melakukan kesalahan terkumpul ke-6 dalam satu separuh masa, pasukan lawan mendapat sepakan percuma tanpa 'wall' dari tanda 10m."
            },
            {
                question: "Bolehkah gol dijaringkan terus dari satu sepakan masuk (kick-in)?",
                options: ["Ya, sentiasa boleh", "Tidak, sama sekali tidak boleh", "Ya, jika bola menyentuh pemain lain", "Hanya jika disepak dengan kuat"],
                answer: "Tidak, sama sekali tidak boleh",
                rationale: "Undang-Undang 15 menyatakan gol tidak boleh dijaringkan terus dari sepakan masuk. Jika bola masuk gol, ia adalah sepakan gol."
            },
            {
                question: "Dari manakah seorang penjaga gol mesti melepaskan bola untuk satu sepakan gol (goal clearance)?",
                options: ["Dari mana-mana dalam padang", "Dari garisan gol", "Dari dalam kawasan penaltinya", "Dari tanda penalti 6m"],
                answer: "Dari dalam kawasan penaltinya",
                rationale: "Untuk sepakan gol, penjaga gol mesti membaling bola dari mana-mana titik di dalam kawasan penaltinya (Undang-Undang 16)."
            },
            {
                question: "Berapa lamakah masa yang diberikan untuk melakukan sepakan masuk (kick-in) atau sepakan sudut?",
                options: ["2 saat", "4 saat", "5 saat", "Tiada had masa"],
                answer: "4 saat",
                rationale: "Pemain mempunyai 4 saat untuk memulakan semula permainan dari sepakan masuk atau sepakan sudut untuk mengekalkan kelancaran permainan."
            },
            {
                question: "Bolehkah seorang penjaga gol menjaringkan gol dengan membaling bola terus ke gol lawan dari kawasannya?",
                options: ["Ya, gol itu sah", "Tidak, gol itu tidak sah", "Ya, tetapi hanya jika bola melantun dahulu", "Tidak, ia adalah sepakan percuma tidak langsung"],
                answer: "Tidak, gol itu tidak sah",
                rationale: "Undang-Undang 10 menyatakan gol tidak sah jika penjaga gol adalah pemain terakhir yang menyentuh bola dengan tangan/lengan dari kawasannya. Permainan dimulakan semula dengan sepakan gol."
            },
            {
                question: "Apakah yang berlaku jika sepakan penalti melantun dari tiang gol dan kembali kepada pengambil sepakan, yang kemudiannya menjaringkan gol?",
                options: ["Gol itu sah", "Gol itu tidak sah, sepakan percuma tidak langsung diberikan", "Sepakan penalti diambil semula", "Permainan diteruskan"],
                answer: "Gol itu sah",
                rationale: "Pemain boleh memainkan bola semula jika ia melantun dari tiang atau palang gol. Bola dianggap 'dalam permainan'."
            },
            {
                question: "Apakah hukuman jika pemain dengan sengaja menghalang penjaga gol daripada melepaskan bola dari tangannya?",
                options: ["Kad kuning", "Sepakan percuma langsung", "Sepakan percuma tidak langsung", "Tiada kesalahan"],
                answer: "Sepakan percuma tidak langsung",
                rationale: "Menghalang penjaga gol melepaskan bola dianggap sebagai kelakuan tidak sportif dan dihukum dengan sepakan percuma tidak langsung."
            },
            {
                question: "Pemain yang dibuang padang (kad merah) boleh digantikan dengan pemain lain selepas...",
                options: ["Perlawanan tamat", "2 minit penuh atau selepas pasukannya dibolosi gol", "5 minit penuh", "Tidak boleh diganti langsung"],
                answer: "2 minit penuh atau selepas pasukannya dibolosi gol",
                rationale: "Pasukan yang kekurangan pemain boleh memasukkan pemain ganti selepas 2 minit atau sebaik sahaja pasukan lawan menjaringkan gol, yang mana lebih awal."
            },
            {
                question: "Jika sepakan percuma tidak langsung disepak terus ke dalam gol lawan tanpa menyentuh pemain lain, apakah keputusannya?",
                options: ["Gol diberikan", "Sepakan percuma diambil semula", "Sepakan gol diberikan", "Sepakan sudut diberikan"],
                answer: "Sepakan gol diberikan",
                rationale: "Gol hanya boleh dijaringkan dari sepakan percuma tidak langsung jika bola menyentuh pemain lain sebelum masuk ke gol."
            },
            {
                question: "Apakah isyarat pengadil untuk 'advantage' selepas satu kesalahan terkumpul dilakukan?",
                options: ["Meniup wisel dengan kuat", "Mengangkat kedua-dua tangan ke atas", "Menunjuk ke arah hadapan dengan kedua-dua tangan", "Menunjuk ke arah hadapan dengan satu tangan sambil memberi isyarat kesalahan terkumpul dengan tangan lain"],
                answer: "Menunjuk ke arah hadapan dengan kedua-dua tangan",
                rationale: "Pengadil akan menghulurkan kedua-dua tangan ke hadapan untuk memberi isyarat 'advantage' dibenarkan."
            },
            {
                question: "Dalam prosedur penggantian, bilakah seorang pemain ganti dibenarkan memasuki padang?",
                options: ["Pada bila-bila masa", "Selepas mendapat isyarat dari pengadil", "Hanya selepas pemain yang diganti telah keluar sepenuhnya dari padang", "Apabila bola berada paling dekat dengan zon penggantian"],
                answer: "Hanya selepas pemain yang diganti telah keluar sepenuhnya dari padang",
                rationale: "Ini adalah peraturan asas dalam prosedur penggantian untuk memastikan bilangan pemain yang betul di atas padang."
            },
            {
                question: "Apakah warna jersi penjaga gol berbanding pemain lain dalam pasukannya?",
                options: ["Mestilah sama", "Mestilah berbeza", "Boleh sama atau berbeza", "Mestilah warna gelap"],
                answer: "Mestilah berbeza",
                rationale: "Warna jersi penjaga gol mesti berbeza daripada pemain lain dan juga pengadil untuk memudahkan pengecaman."
            },
            {
                question: "Apakah keputusan jika pemain melakukan kesalahan yang boleh dihukum dengan kad kuning di luar padang semasa bola dalam permainan?",
                options: ["Tiada tindakan diambil", "Pemain diberi amaran lisan sahaja", "Pemain ditunjukkan kad kuning dan permainan dimulakan semula dengan 'dropped ball'", "Pemain ditunjukkan kad kuning dan sepakan percuma diberikan"],
                answer: "Pemain ditunjukkan kad kuning dan permainan dimulakan semula dengan 'dropped ball'",
                rationale: "Salah laku di luar padang semasa permainan masih boleh dihukum. Permainan dimulakan semula dengan 'dropped ball' kerana kesalahan tidak berlaku di atas padang."
            },
            {
                question: "Berapakah panjang maksimum tempoh masa tambahan jika diperlukan?",
                options: ["Dua separuh masa, 3 minit setiap satu", "Dua separuh masa, 5 minit setiap satu", "Satu separuh masa 10 minit", "Bergantung pada keputusan pengadil"],
                answer: "Dua separuh masa, 5 minit setiap satu",
                rationale: "Jika masa tambahan diperlukan, ia biasanya terdiri daripada dua tempoh 5 minit setiap satu."
            },
            {
                question: "Semasa sepakan dari tanda penalti untuk menentukan pemenang, berapakah bilangan sepakan awal yang diambil oleh setiap pasukan?",
                options: ["3", "5", "6", "1"],
                answer: "5",
                rationale: "Prosedur standard ialah setiap pasukan mengambil 5 sepakan secara berselang-seli untuk menentukan pemenang."
            },
            {
                question: "Jika pemain dengan sengaja meninggalkan padang tanpa kebenaran pengadil, apakah hukumannya?",
                options: ["Tiada hukuman", "Amaran lisan", "Kad kuning", "Kad merah"],
                answer: "Kad kuning",
                rationale: "Meninggalkan padang dengan sengaja tanpa kebenaran dianggap sebagai tingkah laku tidak sportif dan dihukum dengan kad kuning."
            }
        ];


        // Rujukan Elemen DOM
        const loginScreen = document.getElementById('login-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');

        const startQuizBtn = document.getElementById('start-quiz-btn');
        const rollNumberInput = document.getElementById('roll-number');
        const studentInfoDisplay = document.getElementById('student-info-display');
        const studentNameDisplay = document.getElementById('student-name');
        const studentClassDisplay = document.getElementById('student-class');
        const loadingSpinner = document.getElementById('loading-spinner');
        const timerDisplay = document.getElementById('timer-display');

        const questionCounter = document.getElementById('question-counter');
        const scoreCounter = document.getElementById('score-counter');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const answerOptions = document.getElementById('answer-options');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        
        const feedbackSection = document.getElementById('feedback-section');
        const feedbackText = document.getElementById('feedback-text');
        const rationaleText = document.getElementById('rationale-text');

        const resultUserName = document.getElementById('result-user-name');
        const resultUserClass = document.getElementById('result-user-class');
        const finalScore = document.getElementById('final-score');
        const scorePercentage = document.getElementById('score-percentage');
        const resultMessage = document.getElementById('result-message');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');

        let currentQuestionIndex = 0;
        let score = 0;
        let userRollNumber = '';
        let currentStudent = null;
        let timerInterval;
        let timeLeft = quizDuration;

        // Fungsi untuk mengaktifkan mod skrin penuh
        function enterFullScreen() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) { // Firefox
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari and Opera
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
                document.documentElement.msRequestFullscreen();
            }
        }

        // Fungsi untuk memulakan pemasa
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("Masa tamat! Kuiz akan ditamatkan.");
                    showResults();
                }
                updateTimerDisplay();
            }, 1000);
        }

        // Fungsi untuk menghentikan pemasa
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        // Fungsi untuk mengemas kini paparan pemasa
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `Masa: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }


        // Fungsi untuk memulakan kuiz
        function startQuiz() {
            if (!currentStudent) {
                alert('Sila masukkan nombor angka giliran yang sah terlebih dahulu.');
                return;
            }
            
            // Masuk ke mod skrin penuh apabila kuiz dimulakan
            enterFullScreen();
            
            loginScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            currentQuestionIndex = 0;
            score = 0;
            timeLeft = quizDuration;
            startTimer();
            displayQuestion();
        }

        // Fungsi untuk memaparkan soalan
        function displayQuestion() {
            resetState();
            const currentQuestion = quizData[currentQuestionIndex];
            questionText.textContent = currentQuestion.question;
            questionCounter.textContent = `Soalan ${currentQuestionIndex + 1} / ${quizData.length}`;
            scoreCounter.textContent = `Skor: ${score}`;
            
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;

            currentQuestion.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('w-full', 'text-left', 'p-4', 'border', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-100', 'transition-colors', 'duration-200');
                button.addEventListener('click', () => selectAnswer(button, option, currentQuestion.answer, currentQuestion.rationale));
                answerOptions.appendChild(button);
            });
        }
        
        // Fungsi untuk reset state antara soalan
        function resetState() {
            answerOptions.innerHTML = '';
            nextQuestionBtn.classList.add('hidden');
            feedbackSection.classList.add('hidden');
            feedbackText.textContent = '';
            rationaleText.textContent = '';
            rationaleText.className = 'text-sm text-gray-700 p-3 rounded-lg';
        }

        // Fungsi apabila jawapan dipilih
        function selectAnswer(button, selectedOption, correctAnswer, rationale) {
            Array.from(answerOptions.children).forEach(btn => {
                btn.disabled = true; // Disable semua butang selepas jawapan dipilih
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else {
                    btn.classList.add('opacity-60');
                }
            });

            feedbackSection.classList.remove('hidden');

            if (selectedOption === correctAnswer) {
                score++;
                button.classList.add('correct');
                feedbackText.textContent = "Betul!";
                feedbackText.classList.add('text-green-600');
                feedbackText.classList.remove('text-red-600');
                rationaleText.classList.add('bg-green-50', 'rationale-correct');
            } else {
                button.classList.add('incorrect');
                feedbackText.textContent = "Salah!";
                feedbackText.classList.add('text-red-600');
                feedbackText.classList.remove('text-green-600');
                rationaleText.classList.add('bg-red-50', 'rationale-incorrect');
            }
            
            rationaleText.textContent = `Penjelasan: ${rationale}`;
            scoreCounter.textContent = `Skor: ${score}`;
            nextQuestionBtn.classList.remove('hidden');
        }

        // Fungsi untuk menunjukkan keputusan
        async function showResults() {
            stopTimer(); // Hentikan pemasa apabila kuiz selesai
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            resultUserName.textContent = currentStudent.name;
            resultUserClass.textContent = currentStudent.class;
            
            finalScore.textContent = `${score} / ${quizData.length}`;
            const percentage = Math.round((score / quizData.length) * 100);
            scorePercentage.textContent = `(${percentage}%)`;

            let message = '';
            if (percentage >= 80) {
                message = "Cemerlang! Pengetahuan anda tentang undang-undang futsal sangat hebat.";
            } else if (percentage >= 50) {
                message = "Baik! Anda mempunyai pemahaman yang baik, teruskan belajar.";
            } else {
                message = "Jangan putus asa. Cuba lagi untuk tingkatkan pemahaman anda.";
            }
            resultMessage.textContent = message;

            // Simpan markah ke Google Sheets
            await saveScore(userRollNumber, score);
        }
        
        // Fungsi untuk ke soalan seterusnya
        function handleNextButton() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        // Event listener untuk memaparkan butiran pelajar semasa input
        rollNumberInput.addEventListener('input', async (e) => {
            userRollNumber = e.target.value.trim().toUpperCase();
            if (userRollNumber.length > 0) {
                loadingSpinner.classList.remove('hidden');
                startQuizBtn.disabled = true;
                
                try {
                    const student = await fetchStudentData(userRollNumber);
                    currentStudent = student;
                    studentNameDisplay.textContent = student.name;
                    studentClassDisplay.textContent = student.class;
                    studentInfoDisplay.classList.remove('hidden');
                    startQuizBtn.disabled = false;
                } catch (error) {
                    currentStudent = null;
                    studentNameDisplay.textContent = 'Nombor angka giliran tidak sah.';
                    studentClassDisplay.textContent = '';
                    studentInfoDisplay.classList.remove('hidden');
                    startQuizBtn.disabled = true;
                } finally {
                    loadingSpinner.classList.add('hidden');
                }
            } else {
                studentNameDisplay.textContent = '';
                studentClassDisplay.textContent = '';
                studentInfoDisplay.classList.add('hidden');
                startQuizBtn.disabled = true;
            }
        });


        // Fungsi untuk memulakan semula kuiz
        function restartQuiz() {
            resultScreen.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            rollNumberInput.value = '';
            studentInfoDisplay.classList.add('hidden');
            currentStudent = null;
            startQuizBtn.disabled = true;
        }

        // Event Listeners
        startQuizBtn.addEventListener('click', startQuiz);
        nextQuestionBtn.addEventListener('click', handleNextButton);
        restartQuizBtn.addEventListener('click', restartQuiz);

        // Skrip untuk mengesan tumpuan halaman (anti-cheating)
        document.addEventListener("visibilitychange", function() {
            if (document.hidden && !document.fullscreenElement && quizScreen.classList.contains('hidden') === false) {
                if (window.confirm("Amaran: Kuiz akan ditamatkan jika anda beralih tetingkap atau aplikasi. Adakah anda ingin teruskan?")) {
                    // Do nothing, allow them to continue
                } else {
                    alert("Kuiz ditamatkan kerana anda cuba beralih halaman.");
                    showResults(); // Tamatkan kuiz secara paksa
                }
            }
        });

        // Mengesan apabila pengguna keluar dari mod skrin penuh
        document.addEventListener("fullscreenchange", function() {
            if (!document.fullscreenElement && quizScreen.classList.contains('hidden') === false) {
                 if (window.confirm("Amaran: Keluar dari mod skrin penuh akan menamatkan kuiz. Adakah anda ingin teruskan?")) {
                    // Do nothing, allow them to continue
                } else {
                    alert("Kuiz ditamatkan kerana anda cuba keluar dari mod skrin penuh.");
                    showResults(); // Tamatkan kuiz secara paksa
                }
            }
        });

    </script>
</body>
</html>
